
################################
## our HTTP server at port 80 ##
################################
server {
      listen      80 default;
      ## set up domain name here ##
      server_name www.urbanshef.com urbanshef.com
      access_log off;
      error_log off;
      ##** nginx redirect ALL http requests to https ** ##
      return      301 https://$server_name$request_uri;
}
#########################################################################
## Our HTTPS server at port 443. You need to provide ssl config below ###
#########################################################################
server {
      # access_log  logs/urbanshef.com/ssl_access.log main;
      # error_log   logs/urbanshef.com/ssl_error.log;
      # index       index.html;
      # root        /usr/local/nginx/html;
      ## start ssl config ##
      listen      443 http2 ssl;
      server_name www.urbanshef.com urbanshef.com
 
     ## redirect www to nowww
      if ($host = 'www.urbanshef.com' ) {
         rewrite  ^/(.*)$  https://urbanshef.com/$1  permanent;
      }
 
    ### ssl config - customize as per your setup ###
     ssl_certificate /etc/certs/urbanshef_com.crt;
     ssl_certificate_key /etc/certs/definesys.key;
     
     ssl_protocols        TLSv1 TLSv1.1 TLSv1.2;
     keepalive_timeout    70;
     ssl_session_cache    shared:SSL:10m;
     ssl_session_timeout  10m;
    ### Rest of my config. It is optional. Do it only if you have Apache on backend ## 
 
    ## PROXY backend 
      location / {
        add_header           Front-End-Https    on;
        add_header  Cache-Control "public, must-revalidate";
        add_header Strict-Transport-Security "max-age=2592000; includeSubdomains";
        proxy_pass  http://backend:80;
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
        proxy_set_header        Host            $host;
        proxy_set_header        X-Real-IP       $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
      }
}